#### 关键功能-PVE 整体逻辑
通过前端配置 pve 的机器节点名称,以及克隆 vm 所需要的 template id, 以及将这些数据入库,然后和某个课程方案绑定,当某个班级使用了这种课程方案的时候,这个班级的学生就应用这些配置

##### 阶段一实现逻辑
后端通过轮询的方式,调用 pve 的相关 api 来实现 vm 的克隆,自动开机,以及自动关机,以保持 vm 在一定数量

##### 阶段二实现逻辑
- 由于后端代码存在一定问题,因此将克隆 vm 的一些逻辑转移到前端,如果直接在letms 中调用 pve 的相关 api,会有跨域的问题,    
- 即 pve 的 api 中并没有 `Access-Control`相关字段, 此外 前端也要实现 vnc 的功能,
- 因此前人自己写了一个 html,将该 html 放置到 pve 相关目录,以绕开跨域限制,然后通过 iframe 将该 html 文件嵌入进来,    
- 在该 html 页面中通过 pve 相关api 判断 pve 是否存在,存在,则开机,不存在,则克隆,然后开机,并启动 vnc 链接  

##### 概述
综合来说, 这种比较重一点的功能还是做到后端比较好,另外通过前端操作 pve 还有一个问题是,前端本身是无状态的,学生使用完vm 之后,不能及时删除之前的虚拟机,造成pve 的性能有很多的浪费

#### 7.html ,即上文提到的 html 文件,关键代码 如下所示
@[code{282-328} js](./7.html)

#### 项目隐患
1. https 证书问题
pve 的证书是自签名证书,并不安全,用户每次使用 PVE的时候,都需要在 另一个 tab 页打开 pve 页面,例如 `https://10.103.234.44:8006`,并且点击 允许不安全的HTTPS 链接,然后才可以正常访问 pve 的相关功能,导致用户体验非常差
2. pve 性能问题,通过前端开机,会导致 pve 上存在大量的未删除的虚拟机,很影响机器性能
3. 线上环境部署问题, 由于 vnc 目前是用的 pve 的 vnc,其使用了 wss 协议来传输页面以及操作,通过 nginx 转发 wss 失败,因此需要重新考虑如何部署

####  解决方案
1. pve 本身提供 ACME 功能,进行一些配置即可实现 https 证书的自动更新,只是需要实践验证  
2. 需要在 server 端实现开机,并持久化相关信息  
3. 目前暂无相关方案

#### 测试环境 pve 批量操作页面
```shell
https://192.168.31.108:8006/pve-docs/api-viewer/letms-pve-admin.html
```
